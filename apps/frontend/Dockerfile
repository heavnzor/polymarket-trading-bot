FROM node:22-alpine

WORKDIR /app

COPY apps/frontend/package.json ./
RUN npm install

COPY apps/frontend .

ARG NEXT_BASE_PATH=""
ARG NEXT_PUBLIC_CONTROL_PLANE_URL=""
ARG NEXT_PUBLIC_CONTROL_PLANE_WS_URL=""
ARG NEXT_PUBLIC_CONTROL_PLANE_TOKEN=""
ARG DASHBOARD_PASSWORD=""
ENV NEXT_BASE_PATH=${NEXT_BASE_PATH}
ENV NEXT_PUBLIC_CONTROL_PLANE_URL=${NEXT_PUBLIC_CONTROL_PLANE_URL}
ENV NEXT_PUBLIC_CONTROL_PLANE_WS_URL=${NEXT_PUBLIC_CONTROL_PLANE_WS_URL}
ENV NEXT_PUBLIC_CONTROL_PLANE_TOKEN=${NEXT_PUBLIC_CONTROL_PLANE_TOKEN}
ENV DASHBOARD_PASSWORD=${DASHBOARD_PASSWORD}

RUN npm run build

EXPOSE 3000

CMD ["npm", "run", "start", "--", "-p", "3000"]
